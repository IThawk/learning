基于MongoDB实现网络云盘实战

一、上课目的
1.为何要使用MongoDB来实现云盘？ 
(GridFS在Java中应用，缓存中间件，结构化的非关系型数据库)

2.云盘因何而存在？
  来自我本人的一个项目，经过了改造，完全去Servlet化的框架（SpringBoot）
  
3.个人经验分享
  分享自己的经验，相当于全公司所有项目中用到文件存储依赖

百度网盘、腾讯微盘、360网盘、阿里OSS、七牛云 ...

技术准备：SpringBoot 2.0 + MongoDB 4.2


二、设计思路：
文件分类
公共资源public:/   任何人都共享
回收站recycle:/    根据权限，每个人都有一个回收站
我的文件my:/	   每个用户一个虚拟云盘


三、数据隔离
我的文件：  每个人对应一个文件夹，仅此而已（它只不过一串有规律字符串）
匿名用户 anonymous
注册用户
炫耀：10T空间，花了钱VIP，他只不过是一个数字

权限校验而已
CRC、MD5

规定：根目录path  /
      子目录    /XX/XXx/AA/BB/EE
	  子目录    /XX/XXx/AA/DD/CC
	  子目录    /XX/XXx/CC/DD
	  
	  path 包含 /XX/XXx/AA/
	  
在创建文件夹时，同级目录下不允许重名	  

这个文件是由谁上传的

MongoDB存文件风险大？


因为磁盘上目录里面的文件数量是有上限的
用户的注册量达到了


1c465fbc544370bc65a69458535336d3 它就是文件的ID
磁盘的读写性能是没有内存的读写性能高的
文件单体传输非常大

\1c4\65f\bc5\443\70b\c65\a69\458\535\336\d3

\1c4\65f\bc5\443\70b\c65\a69\458\535\336\d3\Test\One\Two\Three\Four


四、高效存储解决方案
磁盘存储，MongoDB存储
虚拟空间管理

多数据源操作


五、主要功能
上传、下载（FlashReader，swf，Word、PDF、Excel、MP4、MP3、PPT）、预览、查询、无限级目录

FFMPEG /多媒体的互转   Word 转成 Swf、 MP4/WVM.... /MP4.H264


六、核心代码演示

1、数据库设计
2、希望核心业务代码手写

.json  ajax交互的格式
.file  针对文件本身的操作，预览，下载

如果做动静分离之后，我会用Nginx来承担一些功能


通常，文件的存储有3种
1. 直接写磁盘，通过nginx来访问。    显然，性能下降
2. 分布式文件系统，比如FastDFS		推荐方案，性能是最高的，易扩容，扩容比较难定
3. MongoDB，你把它当做缓存，方便	不推荐（只是因为恰好我自己做过）




